_selection.setTo(...t)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(t){return this._selection.isEqual(t)}isSimilar(t){return this._selection.isSimilar(t)}_setTo(...t){this._selection.setTo(...t)}_setFocus(t,e){this._selection.setFocus(t,e)}}Cs.prototype.is=function(t){return"selection"===t||"documentSelection"==t||"view:selection"==t||"view:documentSelection"==t};class vs extends m{constructor(t,e,n){super(t,e),this.startRange=n,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}const ys=Symbol("bubbling contexts");function xs(t){return class extends t{fire(t,...e){try{const n=t instanceof m?t:new m(this,t),o=Ss(this);if(!o.size)return;if(Es(n,"capturing",this),Bs(o,"$capture",n,...e))return n.return;const i=n.startRange||this.selection.getFirstRange(),r=i?i.getContainedElement():null,s=!!r&&Boolean(Ds(o,r));let a=r||function(t){if(!t)return null;const e=t.start.parent,n=t.end.parent,o=e.getPath(),i=n.getPath();return o.length>i.length?e:n}(i);if(Es(n,"atTarget",a),!s){if(Bs(o,"$text",n,...e))return n.return;Es(n,"bubbling",a)}for(;a;){if(a.is("rootElement")){if(Bs(o,"$root",n,...e))return n.return}else if(a.is("element")&&Bs(o,a.name,n,...e))return n.return;if(Bs(o,a,n,...e))return n.return;a=a.parent,Es(n,"bubbling",a)}return Es(n,"bubbling",this),Bs(o,"$document",n,...e),n.return}catch(t){A.rethrowUnexpectedError(t,this)}}_addEventListener(t,e,n){const o=vi(n.context||"$document"),i=Ss(this);for(const r of o){let o=i.get(r);o||(o=new(P()),i.set(r,o)),this.listenTo(o,t,e,n)}}_removeEventListener(t,e){const n=Ss(this);for(const o of n.values())this.stopListening(o,t,e)}}}{const t=xs(Object);["fire","_addEventListener","_removeEventListener"].forEach((e=>{xs[e]=t.prototype[e]}))}function Es(t,e,n){t instanceof vs&&(t._eventPhase=e,t._currentTarget=n)}function Bs(t,e,n,...o){const i="string"==typeof e?t.get(e):Ds(t,e);return!!i&&(i.fire(n,...o),n.stop.called)}function Ds(t,e){for(const[n,o]of t)if("function"==typeof n&&n(e))return o;return null}function Ss(t){return t[ys]||(t[ys]=new Map),t[ys]}class Ts extends(xs(K())){constructor(t){super(),this._postFixers=new Set,this.selection=new Cs,this.roots=new Wi({idProperty:"rootName"}),this.stylesProcessor=t,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1)}getRoot(t="main"){return this.roots.get(t)}registerPostFixer(t){this._postFixers.add(t)}destroy(){this.roots.forEach((t=>t.destroy())),this.stopListening()}_callPostFixers(t){let e=!1;do{for(const n of this._postFixers)if(e=n(t),e)break}while(e)}}class Ps extends ds{constructor(t,e,n,o){super(t,e,n,o),this._priority=10,this._id=null,this._clonesGroup=null,this.getFillerOffset=Ms}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(null===this.id)throw new A("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(t){return null!==this.id||null!==t.id?this.id===t.id:super.isSimilar(t)&&this.priority==t.priority}_clone(t=!1){const e=super._clone(t);return e._priority=this._priority,e._id=this._id,e}}Ps.DEFAULT_PRIORITY=10;const Is=Ps;function Ms(){if(Rs(this))return null;let t=this.parent;for(;t&&t.is("attributeElement");){if(Rs(t)>1)return null;t=t.parent}return!t||Rs(t)>1?null:this.childCount}function Rs(t){return Array.from(t.getChildren()).filter((t=>!t.is("uiElement"))).length}Ps.prototype.is=function(t,e){return e?e===this.name&&("attributeElement"===t||"view:attributeElement"===t||"element"===t||"view:element"===t):"attributeElement"===t||"view:attributeElement"===t||"element"===t||"view:element"===t||"node"===t||"view:node"===t};class Fs extends ds{constructor(t,e,n,o){super(t,e,n,o),this.getFillerOffset=Ls}_insertChild(t,e){if(e&&(e instanceof Br||Array.from(e).length>0))throw new A("view-emptyelement-cannot-add",[this,e]);return 0}}function Ls(){return null}Fs.prototype.is=function(t,e){return e?e===this.name&&("emptyElement"===t||"view:emptyElement"===t||"element"===t||"view:element"===t):"emptyElement"===t||"view:emptyElement"===t||"element"===t||"view:element"===t||"node"===t||"view:node"===t};class Vs extends ds{constructor(t,e,n,o){super(t,e,n,o),this.getFillerOffset=zs}_insertChild(t,e){if(e&&(e instanceof Br||Array.from(e).length>0))throw new A("view-uielement-cannot-add",[this,e]);return 0}render(t,e){return this.toDomElement(t)}toDomElement(t){const e=t.createElement(this.name);for(const t of this.getAttributeKeys())e.setAttribute(t,this.getAttribute(t));return e}}function Os(t){t.document.on("arrowKey",((e,n)=>function(t,e,n){if(e.keyCode==fi.arrowright){const t=e.domTarget.ownerDocument.defaultView.getSelection(),o=1==t.rangeCount&&t.getRangeAt(0).colla